<html>
<head>

<script type="text/javascript" src="js/prototype.js"></script>
<script type="text/javascript" src="fx/flapjax.js"></script>

<title>Flapjax Demo: Wanderling Letters</title>

<script type="text/javascript">

function loader() {

  // Figure out the initial condition of the first value.
  elapsedTimeB = (function (x) {
    var t = timerB(100);
    var start = valueNow(t);
    return t.liftB(function(x) {return x - start});})();

  function nextPos(elapsedTime, targetX, targetY, curX, curY) {
    var diffX = targetX - curX;
    var diffY = targetY - curY;
    var norm = Math.sqrt(diffX * diffX + diffY * diffY);
    if (norm == 0) {
      return {x: curX, y: curY};
    }
    var speed = Math.min(norm, 13);
    var speedX = (diffX/norm) * speed;
    var speedY = (diffY/norm) * speed;
    return {x: curX + speedX, y: curY + speedY};
  };

  var TextFieldWidth = 300;
  var TextFieldHeight = 300;
  var ary = 'Hello'.split('');

  var posArray = new Array(5);
  var posXArray = new Array(5);
  var posYArray = new Array(5);

  for (i = 0; i < 5; i++) {
    var f = (function() {
      var ii = i;
      return function (time) {
        var me = $('p' + ii);
        var prev = ii == 0 ? null : $('p' + (ii-1));
        if (ii != 0) {
	  var dim = prev.getDimensions();
        }
        return nextPos(time,
      	     	          prev == null ? 0 : parseFloat(prev.style.getPropertyValue('left')) + dim.width,
      	     	          prev == null ? 0 : parseFloat(prev.style.getPropertyValue('top')),
                          parseFloat(me.style.getPropertyValue('left')),
                          parseFloat(me.style.getPropertyValue('top')))}})();
    posArray[i] = elapsedTimeB
                  .changes()
                  .mapE(f)
                  .startsWith({x: Math.random() * TextFieldWidth, y: Math.random() * TextFieldHeight});
   posXArray[i] = posArray[i].liftB(function(x) {return x.x;});
   posYArray[i] = posArray[i].liftB(function(y) {return y.y;});
  }

  for (i = 0; i < 5; i++) {
    insertDomB(
      DIV({style: { position: 'absolute',
                    left: posXArray[i],
                    top: posYArray[i] }, id: 'p' + i},
          ary[i]),
      'p' + i);
  }

}
</script>
</head>
<body onload="loader()">
<span id="p0">H</span>
<span id="p1">e</span>
<span id="p2">l</span>
<span id="p3">l</span>
<span id="p4">o</span>
</body>
</html>

